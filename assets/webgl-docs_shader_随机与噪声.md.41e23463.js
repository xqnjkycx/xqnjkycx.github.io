import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.6d94f49f.js";const p="/assets/雪花图.c960e933.png",o="/assets/噪点照片.62206c5d.png",e="/assets/噪声图.e885e730.png",c="/assets/噪声过渡.53899f71.png",t="/assets/云层噪声.8f16bd30.png",x=JSON.parse('{"title":"随机与噪声","description":"","frontmatter":{},"headers":[],"relativePath":"webgl-docs/shader/随机与噪声.md","filePath":"webgl-docs/shader/随机与噪声.md","lastUpdated":1701765576000}'),r={name:"webgl-docs/shader/随机与噪声.md"},y=l(`<h1 id="随机与噪声" tabindex="-1">随机与噪声 <a class="header-anchor" href="#随机与噪声" aria-label="Permalink to &quot;随机与噪声&quot;">​</a></h1><p>之前绘制的大部分图案都是有序的，规律的，但其实现实的大部分景象都是无序和混乱的。</p><p>由于Shader是和数学紧密相关的，而在数学中，跟无序与混沌最接近的一个概念就是<strong>随机</strong>。</p><h2 id="启动模版" tabindex="-1">启动模版 <a class="header-anchor" href="#启动模版" aria-label="Permalink to &quot;启动模版&quot;">​</a></h2><p>新建一个<code>.glsl</code>文件，初始化代码如下：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mainImage</span><span style="color:#E1E4E8;">(out vec4 </span><span style="color:#FFAB70;">fragColor</span><span style="color:#E1E4E8;">,in vec2 </span><span style="color:#FFAB70;">fragCoord</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec2 uv</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fragCoord</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">iResolution.xy;</span></span>
<span class="line"><span style="color:#E1E4E8;">    fragColor</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(uv,</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mainImage</span><span style="color:#24292E;">(out vec4 </span><span style="color:#E36209;">fragColor</span><span style="color:#24292E;">,in vec2 </span><span style="color:#E36209;">fragCoord</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    vec2 uv</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fragCoord</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">iResolution.xy;</span></span>
<span class="line"><span style="color:#24292E;">    fragColor</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(uv,</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h2 id="随机函数" tabindex="-1">随机函数 <a class="header-anchor" href="#随机函数" aria-label="Permalink to &quot;随机函数&quot;">​</a></h2><p>在<code>JS</code>中，可以有内置的随机函数<code>Math.random</code>来模拟随机，但是<code>GLSL</code>却没有内置的随机函数可以使用，但是在<code>GitHub</code>上，已经有人封装好了随机函数<a href="https://github.com/mattdesl/glsl-random" target="_blank" rel="noreferrer">glsl-random</a>，来看看长什么样子：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">(vec2 </span><span style="color:#FFAB70;">co</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> a</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">12.9898</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> b</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">78.233</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> c</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">43758.5453</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> dt</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(co.xy,</span><span style="color:#B392F0;">vec2</span><span style="color:#E1E4E8;">(a,b));</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> sn</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">mod</span><span style="color:#E1E4E8;">(dt,</span><span style="color:#79B8FF;">3.14</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">fract</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">sin</span><span style="color:#E1E4E8;">(sn)</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">c);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">random</span><span style="color:#24292E;">(vec2 </span><span style="color:#E36209;">co</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> a</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">12.9898</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> b</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">78.233</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> c</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">43758.5453</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> dt</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(co.xy,</span><span style="color:#6F42C1;">vec2</span><span style="color:#24292E;">(a,b));</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> sn</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">mod</span><span style="color:#24292E;">(dt,</span><span style="color:#005CC5;">3.14</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">fract</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">sin</span><span style="color:#24292E;">(sn)</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">c);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>这个随机函数的意义是取<code>sin</code>函数偏后面的小数部分来模拟随机的效果，传入uv坐标，可以得出一个雪花图结果。</p><p><img src="`+p+`" alt="雪花图"></p><h2 id="颗粒化滤镜" tabindex="-1">颗粒化滤镜 <a class="header-anchor" href="#颗粒化滤镜" aria-label="Permalink to &quot;颗粒化滤镜&quot;">​</a></h2><p>如果将这些噪点与纹理叠加在一起，就会得到一种老相片的滤镜的感觉～</p><p>完整代码如下：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">#iChannel0</span><span style="color:#9ECBFF;">&quot;https://s2.loli.net/2023/09/10/QozT59R6KsYmb3q.jpg&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">(vec2 </span><span style="color:#FFAB70;">co</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> a</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">12.9898</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> b</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">78.233</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> c</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">43758.5453</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> dt</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(co.xy,</span><span style="color:#B392F0;">vec2</span><span style="color:#E1E4E8;">(a,b));</span></span>
<span class="line"><span style="color:#E1E4E8;">    highp </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> sn</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">mod</span><span style="color:#E1E4E8;">(dt,</span><span style="color:#79B8FF;">3.14</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">fract</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">sin</span><span style="color:#E1E4E8;">(sn)</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">c);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mainImage</span><span style="color:#E1E4E8;">(out vec4 </span><span style="color:#FFAB70;">fragColor</span><span style="color:#E1E4E8;">,in vec2 </span><span style="color:#FFAB70;">fragCoord</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec2 uv</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fragCoord</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">iResolution.xy;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> noise</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">(uv);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 col</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">texture</span><span style="color:#E1E4E8;">(iChannel0,uv).xyz;</span></span>
<span class="line"><span style="color:#E1E4E8;">    col</span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;">noise</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">.2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    fragColor</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(col,</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">#iChannel0</span><span style="color:#032F62;">&quot;https://s2.loli.net/2023/09/10/QozT59R6KsYmb3q.jpg&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">random</span><span style="color:#24292E;">(vec2 </span><span style="color:#E36209;">co</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> a</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">12.9898</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> b</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">78.233</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> c</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">43758.5453</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> dt</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(co.xy,</span><span style="color:#6F42C1;">vec2</span><span style="color:#24292E;">(a,b));</span></span>
<span class="line"><span style="color:#24292E;">    highp </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> sn</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">mod</span><span style="color:#24292E;">(dt,</span><span style="color:#005CC5;">3.14</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">fract</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">sin</span><span style="color:#24292E;">(sn)</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">c);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mainImage</span><span style="color:#24292E;">(out vec4 </span><span style="color:#E36209;">fragColor</span><span style="color:#24292E;">,in vec2 </span><span style="color:#E36209;">fragCoord</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    vec2 uv</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fragCoord</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">iResolution.xy;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> noise</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">random</span><span style="color:#24292E;">(uv);</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    vec3 col</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">texture</span><span style="color:#24292E;">(iChannel0,uv).xyz;</span></span>
<span class="line"><span style="color:#24292E;">    col</span><span style="color:#D73A49;">+=</span><span style="color:#24292E;">noise</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">.2</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    fragColor</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(col,</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><img src="`+o+`" alt="噪点背景图"></p><h2 id="噪声" tabindex="-1">噪声 <a class="header-anchor" href="#噪声" aria-label="Permalink to &quot;噪声&quot;">​</a></h2><p>噪声也是实现“随机”的一种手段，只不过它能使实现的效果更佳偏“自然”一些。</p><p>平时生活中看到的一些云雾，岩石，火焰等，都是存在噪声的。</p><p>同样，和缺少的内置函数一样，<code>GLSL</code>里同样也没有内置的噪声函数。但是<code>GitHub</code>上，也有封装好的噪声函数<a href="https://github.com/hughsk/glsl-noise" target="_blank" rel="noreferrer">glsl-noise</a>。</p><p>这里选择其中比较常用的柏林噪声<code>Perlin Noise</code>的<code>3d</code>版本，可以查看它是什么样子的。</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"><span style="color:#6A737D;">// GLSL textureless classic 3D noise &quot;cnoise&quot;,</span></span>
<span class="line"><span style="color:#6A737D;">// with an RSL-style periodic variant &quot;pnoise&quot;.</span></span>
<span class="line"><span style="color:#6A737D;">// Author:  Stefan Gustavson (stefan.gustavson@liu.se)</span></span>
<span class="line"><span style="color:#6A737D;">// Version: 2011-10-11</span></span>
<span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"><span style="color:#6A737D;">// Many thanks to Ian McEwan of Ashima Arts for the</span></span>
<span class="line"><span style="color:#6A737D;">// ideas for permutation and gradient selection.</span></span>
<span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"><span style="color:#6A737D;">// Copyright (c) 2011 Stefan Gustavson. All rights reserved.</span></span>
<span class="line"><span style="color:#6A737D;">// Distributed under the MIT license. See LICENSE file.</span></span>
<span class="line"><span style="color:#6A737D;">// https://github.com/ashima/webgl-noise</span></span>
<span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec3</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mod289</span><span style="color:#E1E4E8;">(vec3 </span><span style="color:#FFAB70;">x</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> x</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(x</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1.</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">289.</span><span style="color:#E1E4E8;">))</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">289.</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mod289</span><span style="color:#E1E4E8;">(vec4 </span><span style="color:#FFAB70;">x</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> x</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(x</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1.</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">289.</span><span style="color:#E1E4E8;">))</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">289.</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">permute</span><span style="color:#E1E4E8;">(vec4 </span><span style="color:#FFAB70;">x</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mod289</span><span style="color:#E1E4E8;">(((x</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">34.</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">x);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">taylorInvSqrt</span><span style="color:#E1E4E8;">(vec4 </span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.79284291400159</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">.85373472095314</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">r;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec3</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">fade</span><span style="color:#E1E4E8;">(vec3 </span><span style="color:#FFAB70;">t</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> t</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(t</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(t</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">6.</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">15.</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">10.</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Classic Perlin noise</span></span>
<span class="line"><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">cnoise</span><span style="color:#E1E4E8;">(vec3 </span><span style="color:#FFAB70;">P</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 Pi0</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(P);</span><span style="color:#6A737D;">// Integer part for indexing</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 Pi1</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">Pi0</span><span style="color:#F97583;">+</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">);</span><span style="color:#6A737D;">// Integer part + 1</span></span>
<span class="line"><span style="color:#E1E4E8;">    Pi0</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">mod289</span><span style="color:#E1E4E8;">(Pi0);</span></span>
<span class="line"><span style="color:#E1E4E8;">    Pi1</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">mod289</span><span style="color:#E1E4E8;">(Pi1);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 Pf0</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">fract</span><span style="color:#E1E4E8;">(P);</span><span style="color:#6A737D;">// Fractional part for interpolation</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 Pf1</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">Pf0</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">);</span><span style="color:#6A737D;">// Fractional part - 1.0</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 ix</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(Pi0.x,Pi1.x,Pi0.x,Pi1.x);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 iy</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(Pi0.yy,Pi1.yy);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 iz0</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">Pi0.zzzz;</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 iz1</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">Pi1.zzzz;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 ixy</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">permute</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">permute</span><span style="color:#E1E4E8;">(ix)</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">iy);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 ixy0</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">permute</span><span style="color:#E1E4E8;">(ixy</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">iz0);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 ixy1</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">permute</span><span style="color:#E1E4E8;">(ixy</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">iz1);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 gx0</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">ixy0</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1.</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">7.</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 gy0</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">fract</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(gx0)</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1.</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">7.</span><span style="color:#E1E4E8;">))</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    gx0</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">fract</span><span style="color:#E1E4E8;">(gx0);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 gz0</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">abs</span><span style="color:#E1E4E8;">(gx0)</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">abs</span><span style="color:#E1E4E8;">(gy0);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 sz0</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">step</span><span style="color:#E1E4E8;">(gz0,</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    gx0</span><span style="color:#F97583;">-=</span><span style="color:#E1E4E8;">sz0</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">step</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">,gx0)</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    gy0</span><span style="color:#F97583;">-=</span><span style="color:#E1E4E8;">sz0</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">step</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">,gy0)</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 gx1</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">ixy1</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1.</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">7.</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 gy1</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">fract</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(gx1)</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1.</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">7.</span><span style="color:#E1E4E8;">))</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    gx1</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">fract</span><span style="color:#E1E4E8;">(gx1);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 gz1</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">abs</span><span style="color:#E1E4E8;">(gx1)</span><span style="color:#F97583;">-</span><span style="color:#B392F0;">abs</span><span style="color:#E1E4E8;">(gy1);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 sz1</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">step</span><span style="color:#E1E4E8;">(gz1,</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    gx1</span><span style="color:#F97583;">-=</span><span style="color:#E1E4E8;">sz1</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">step</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">,gx1)</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    gy1</span><span style="color:#F97583;">-=</span><span style="color:#E1E4E8;">sz1</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">step</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">,gy1)</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 g000</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(gx0.x,gy0.x,gz0.x);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 g100</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(gx0.y,gy0.y,gz0.y);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 g010</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(gx0.z,gy0.z,gz0.z);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 g110</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(gx0.w,gy0.w,gz0.w);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 g001</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(gx1.x,gy1.x,gz1.x);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 g101</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(gx1.y,gy1.y,gz1.y);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 g011</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(gx1.z,gy1.z,gz1.z);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 g111</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(gx1.w,gy1.w,gz1.w);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 norm0</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">taylorInvSqrt</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g000,g000),</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g010,g010),</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g100,g100),</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g110,g110)));</span></span>
<span class="line"><span style="color:#E1E4E8;">    g000</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">norm0.x;</span></span>
<span class="line"><span style="color:#E1E4E8;">    g010</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">norm0.y;</span></span>
<span class="line"><span style="color:#E1E4E8;">    g100</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">norm0.z;</span></span>
<span class="line"><span style="color:#E1E4E8;">    g110</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">norm0.w;</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 norm1</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">taylorInvSqrt</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g001,g001),</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g011,g011),</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g101,g101),</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g111,g111)));</span></span>
<span class="line"><span style="color:#E1E4E8;">    g001</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">norm1.x;</span></span>
<span class="line"><span style="color:#E1E4E8;">    g011</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">norm1.y;</span></span>
<span class="line"><span style="color:#E1E4E8;">    g101</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">norm1.z;</span></span>
<span class="line"><span style="color:#E1E4E8;">    g111</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">norm1.w;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n000</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g000,Pf0);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n100</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g100,</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(Pf1.x,Pf0.yz));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n010</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g010,</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(Pf0.x,Pf1.y,Pf0.z));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n110</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g110,</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(Pf1.xy,Pf0.z));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n001</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g001,</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(Pf0.xy,Pf1.z));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n101</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g101,</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(Pf1.x,Pf0.y,Pf1.z));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n011</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g011,</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(Pf0.x,Pf1.yz));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n111</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(g111,Pf1);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 fade_xyz</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">fade</span><span style="color:#E1E4E8;">(Pf0);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 n_z</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">mix</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(n000,n100,n010,n110),</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(n001,n101,n011,n111),fade_xyz.z);</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec2 n_yz</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">mix</span><span style="color:#E1E4E8;">(n_z.xy,n_z.zw,fade_xyz.y);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n_xyz</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">mix</span><span style="color:#E1E4E8;">(n_yz.x,n_yz.y,fade_xyz.x);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2.2</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">n_xyz;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"><span style="color:#6A737D;">// GLSL textureless classic 3D noise &quot;cnoise&quot;,</span></span>
<span class="line"><span style="color:#6A737D;">// with an RSL-style periodic variant &quot;pnoise&quot;.</span></span>
<span class="line"><span style="color:#6A737D;">// Author:  Stefan Gustavson (stefan.gustavson@liu.se)</span></span>
<span class="line"><span style="color:#6A737D;">// Version: 2011-10-11</span></span>
<span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"><span style="color:#6A737D;">// Many thanks to Ian McEwan of Ashima Arts for the</span></span>
<span class="line"><span style="color:#6A737D;">// ideas for permutation and gradient selection.</span></span>
<span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"><span style="color:#6A737D;">// Copyright (c) 2011 Stefan Gustavson. All rights reserved.</span></span>
<span class="line"><span style="color:#6A737D;">// Distributed under the MIT license. See LICENSE file.</span></span>
<span class="line"><span style="color:#6A737D;">// https://github.com/ashima/webgl-noise</span></span>
<span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec3</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mod289</span><span style="color:#24292E;">(vec3 </span><span style="color:#E36209;">x</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> x</span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(x</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1.</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">289.</span><span style="color:#24292E;">))</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">289.</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mod289</span><span style="color:#24292E;">(vec4 </span><span style="color:#E36209;">x</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> x</span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(x</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1.</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">289.</span><span style="color:#24292E;">))</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">289.</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">permute</span><span style="color:#24292E;">(vec4 </span><span style="color:#E36209;">x</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mod289</span><span style="color:#24292E;">(((x</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">34.</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">x);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">taylorInvSqrt</span><span style="color:#24292E;">(vec4 </span><span style="color:#E36209;">r</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.79284291400159</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">.85373472095314</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">r;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec3</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">fade</span><span style="color:#24292E;">(vec3 </span><span style="color:#E36209;">t</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> t</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(t</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(t</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">6.</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">15.</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">10.</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Classic Perlin noise</span></span>
<span class="line"><span style="color:#D73A49;">float</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">cnoise</span><span style="color:#24292E;">(vec3 </span><span style="color:#E36209;">P</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    vec3 Pi0</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(P);</span><span style="color:#6A737D;">// Integer part for indexing</span></span>
<span class="line"><span style="color:#24292E;">    vec3 Pi1</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">Pi0</span><span style="color:#D73A49;">+</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">);</span><span style="color:#6A737D;">// Integer part + 1</span></span>
<span class="line"><span style="color:#24292E;">    Pi0</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">mod289</span><span style="color:#24292E;">(Pi0);</span></span>
<span class="line"><span style="color:#24292E;">    Pi1</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">mod289</span><span style="color:#24292E;">(Pi1);</span></span>
<span class="line"><span style="color:#24292E;">    vec3 Pf0</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">fract</span><span style="color:#24292E;">(P);</span><span style="color:#6A737D;">// Fractional part for interpolation</span></span>
<span class="line"><span style="color:#24292E;">    vec3 Pf1</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">Pf0</span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">);</span><span style="color:#6A737D;">// Fractional part - 1.0</span></span>
<span class="line"><span style="color:#24292E;">    vec4 ix</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(Pi0.x,Pi1.x,Pi0.x,Pi1.x);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 iy</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(Pi0.yy,Pi1.yy);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 iz0</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">Pi0.zzzz;</span></span>
<span class="line"><span style="color:#24292E;">    vec4 iz1</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">Pi1.zzzz;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    vec4 ixy</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">permute</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">permute</span><span style="color:#24292E;">(ix)</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">iy);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 ixy0</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">permute</span><span style="color:#24292E;">(ixy</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">iz0);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 ixy1</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">permute</span><span style="color:#24292E;">(ixy</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">iz1);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    vec4 gx0</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">ixy0</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1.</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">7.</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 gy0</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">fract</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(gx0)</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1.</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">7.</span><span style="color:#24292E;">))</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    gx0</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">fract</span><span style="color:#24292E;">(gx0);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 gz0</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">abs</span><span style="color:#24292E;">(gx0)</span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">abs</span><span style="color:#24292E;">(gy0);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 sz0</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">step</span><span style="color:#24292E;">(gz0,</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">    gx0</span><span style="color:#D73A49;">-=</span><span style="color:#24292E;">sz0</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">step</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">,gx0)</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    gy0</span><span style="color:#D73A49;">-=</span><span style="color:#24292E;">sz0</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">step</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">,gy0)</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    vec4 gx1</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">ixy1</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1.</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">7.</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 gy1</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">fract</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(gx1)</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1.</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">7.</span><span style="color:#24292E;">))</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    gx1</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">fract</span><span style="color:#24292E;">(gx1);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 gz1</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">abs</span><span style="color:#24292E;">(gx1)</span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">abs</span><span style="color:#24292E;">(gy1);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 sz1</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">step</span><span style="color:#24292E;">(gz1,</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">    gx1</span><span style="color:#D73A49;">-=</span><span style="color:#24292E;">sz1</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">step</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">,gx1)</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    gy1</span><span style="color:#D73A49;">-=</span><span style="color:#24292E;">sz1</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">step</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">,gy1)</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    vec3 g000</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(gx0.x,gy0.x,gz0.x);</span></span>
<span class="line"><span style="color:#24292E;">    vec3 g100</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(gx0.y,gy0.y,gz0.y);</span></span>
<span class="line"><span style="color:#24292E;">    vec3 g010</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(gx0.z,gy0.z,gz0.z);</span></span>
<span class="line"><span style="color:#24292E;">    vec3 g110</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(gx0.w,gy0.w,gz0.w);</span></span>
<span class="line"><span style="color:#24292E;">    vec3 g001</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(gx1.x,gy1.x,gz1.x);</span></span>
<span class="line"><span style="color:#24292E;">    vec3 g101</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(gx1.y,gy1.y,gz1.y);</span></span>
<span class="line"><span style="color:#24292E;">    vec3 g011</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(gx1.z,gy1.z,gz1.z);</span></span>
<span class="line"><span style="color:#24292E;">    vec3 g111</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(gx1.w,gy1.w,gz1.w);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    vec4 norm0</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">taylorInvSqrt</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g000,g000),</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g010,g010),</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g100,g100),</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g110,g110)));</span></span>
<span class="line"><span style="color:#24292E;">    g000</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">norm0.x;</span></span>
<span class="line"><span style="color:#24292E;">    g010</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">norm0.y;</span></span>
<span class="line"><span style="color:#24292E;">    g100</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">norm0.z;</span></span>
<span class="line"><span style="color:#24292E;">    g110</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">norm0.w;</span></span>
<span class="line"><span style="color:#24292E;">    vec4 norm1</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">taylorInvSqrt</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g001,g001),</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g011,g011),</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g101,g101),</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g111,g111)));</span></span>
<span class="line"><span style="color:#24292E;">    g001</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">norm1.x;</span></span>
<span class="line"><span style="color:#24292E;">    g011</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">norm1.y;</span></span>
<span class="line"><span style="color:#24292E;">    g101</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">norm1.z;</span></span>
<span class="line"><span style="color:#24292E;">    g111</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">norm1.w;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n000</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g000,Pf0);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n100</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g100,</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(Pf1.x,Pf0.yz));</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n010</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g010,</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(Pf0.x,Pf1.y,Pf0.z));</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n110</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g110,</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(Pf1.xy,Pf0.z));</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n001</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g001,</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(Pf0.xy,Pf1.z));</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n101</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g101,</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(Pf1.x,Pf0.y,Pf1.z));</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n011</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g011,</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(Pf0.x,Pf1.yz));</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n111</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(g111,Pf1);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    vec3 fade_xyz</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">fade</span><span style="color:#24292E;">(Pf0);</span></span>
<span class="line"><span style="color:#24292E;">    vec4 n_z</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">mix</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(n000,n100,n010,n110),</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(n001,n101,n011,n111),fade_xyz.z);</span></span>
<span class="line"><span style="color:#24292E;">    vec2 n_yz</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">mix</span><span style="color:#24292E;">(n_z.xy,n_z.zw,fade_xyz.y);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n_xyz</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">mix</span><span style="color:#24292E;">(n_yz.x,n_yz.y,fade_xyz.x);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2.2</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">n_xyz;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>传入到uv中，看看输出👀</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mainImage</span><span style="color:#E1E4E8;">(out vec4 </span><span style="color:#FFAB70;">fragColor</span><span style="color:#E1E4E8;">,in vec2 </span><span style="color:#FFAB70;">fragCoord</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec2 uv</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fragCoord</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">iResolution.xy;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> noise</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">cnoise</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(uv</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">10.</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    vec3 col</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(noise);</span></span>
<span class="line"><span style="color:#E1E4E8;">    fragColor</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(col,</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mainImage</span><span style="color:#24292E;">(out vec4 </span><span style="color:#E36209;">fragColor</span><span style="color:#24292E;">,in vec2 </span><span style="color:#E36209;">fragCoord</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    vec2 uv</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fragCoord</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">iResolution.xy;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> noise</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">cnoise</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(uv</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">10.</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    vec3 col</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(noise);</span></span>
<span class="line"><span style="color:#24292E;">    fragColor</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(col,</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>缩放uv坐标10倍之后，可以看到噪声图如下⬇️</p><p><img src="`+e+`" alt="噪声图"></p><h2 id="噪声转场" tabindex="-1">噪声转场 <a class="header-anchor" href="#噪声转场" aria-label="Permalink to &quot;噪声转场&quot;">​</a></h2><p>之前有写过遮罩转场效果，现在可以加上噪声做出更好的效果。加入两张纹理。</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">#iChannel0 </span><span style="color:#9ECBFF;">&quot;https://s2.loli.net/2023/09/10/QozT59R6KsYmb3q.jpg&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">#iChannel1 </span><span style="color:#9ECBFF;">&quot;https://s2.loli.net/2023/09/10/Jb8mIhZMBElPiuC.jpg&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">#iChannel0 </span><span style="color:#032F62;">&quot;https://s2.loli.net/2023/09/10/QozT59R6KsYmb3q.jpg&quot;</span></span>
<span class="line"><span style="color:#24292E;">#iChannel1 </span><span style="color:#032F62;">&quot;https://s2.loli.net/2023/09/10/Jb8mIhZMBElPiuC.jpg&quot;</span></span></code></pre></div><p>写下如下的代码：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">vec4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getFromColor</span><span style="color:#E1E4E8;">(vec2 </span><span style="color:#FFAB70;">uv</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">texture</span><span style="color:#E1E4E8;">(iChannel0,uv);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getToColor</span><span style="color:#E1E4E8;">(vec2 </span><span style="color:#FFAB70;">uv</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">texture</span><span style="color:#E1E4E8;">(iChannel1,uv);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sdfCircle</span><span style="color:#E1E4E8;">(vec2 </span><span style="color:#FFAB70;">p</span><span style="color:#E1E4E8;">,</span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">length</span><span style="color:#E1E4E8;">(p)</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">r;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">transition</span><span style="color:#E1E4E8;">(vec2 </span><span style="color:#FFAB70;">uv</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> progress</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">iMouse.x</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">iResolution.x;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> ratio</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">iResolution.x</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">iResolution.y;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    vec2 p</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">uv;</span></span>
<span class="line"><span style="color:#E1E4E8;">    p</span><span style="color:#F97583;">-=</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    p.x</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">ratio;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> noise</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">cnoise</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(p</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">10.</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> pr</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">progress</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">noise</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">.1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> d</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">sdfCircle</span><span style="color:#E1E4E8;">(p,pr</span><span style="color:#F97583;">*</span><span style="color:#B392F0;">sqrt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2.4</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> c</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">smoothstep</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">.1</span><span style="color:#E1E4E8;">,</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">.05</span><span style="color:#E1E4E8;">,d);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mix</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">getFromColor</span><span style="color:#E1E4E8;">(uv),</span><span style="color:#B392F0;">getToColor</span><span style="color:#E1E4E8;">(uv),</span><span style="color:#79B8FF;">1.</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">c);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mainImage</span><span style="color:#E1E4E8;">(out vec4 </span><span style="color:#FFAB70;">fragColor</span><span style="color:#E1E4E8;">,in vec2 </span><span style="color:#FFAB70;">fragCoord</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    vec2 uv</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fragCoord</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">iResolution.xy;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    vec4 col</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">transition</span><span style="color:#E1E4E8;">(uv);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    fragColor</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">col;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">vec4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getFromColor</span><span style="color:#24292E;">(vec2 </span><span style="color:#E36209;">uv</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">texture</span><span style="color:#24292E;">(iChannel0,uv);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getToColor</span><span style="color:#24292E;">(vec2 </span><span style="color:#E36209;">uv</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">texture</span><span style="color:#24292E;">(iChannel1,uv);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">float</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sdfCircle</span><span style="color:#24292E;">(vec2 </span><span style="color:#E36209;">p</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> </span><span style="color:#E36209;">r</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">length</span><span style="color:#24292E;">(p)</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">r;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">transition</span><span style="color:#24292E;">(vec2 </span><span style="color:#E36209;">uv</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> progress</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">iMouse.x</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">iResolution.x;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> ratio</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">iResolution.x</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">iResolution.y;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    vec2 p</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">uv;</span></span>
<span class="line"><span style="color:#24292E;">    p</span><span style="color:#D73A49;">-=</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    p.x</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">ratio;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> noise</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">cnoise</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(p</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">10.</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> pr</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">progress</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">noise</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">.1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> d</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">sdfCircle</span><span style="color:#24292E;">(p,pr</span><span style="color:#D73A49;">*</span><span style="color:#6F42C1;">sqrt</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2.4</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> c</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">smoothstep</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">.1</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">.05</span><span style="color:#24292E;">,d);</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mix</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">getFromColor</span><span style="color:#24292E;">(uv),</span><span style="color:#6F42C1;">getToColor</span><span style="color:#24292E;">(uv),</span><span style="color:#005CC5;">1.</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">c);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mainImage</span><span style="color:#24292E;">(out vec4 </span><span style="color:#E36209;">fragColor</span><span style="color:#24292E;">,in vec2 </span><span style="color:#E36209;">fragCoord</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    vec2 uv</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fragCoord</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">iResolution.xy;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    vec4 col</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">transition</span><span style="color:#24292E;">(uv);</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    fragColor</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">col;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>可以得到如下的转场效果： <img src="`+c+`" alt="噪声过渡"></p><h2 id="fbm" tabindex="-1">FBM <a class="header-anchor" href="#fbm" aria-label="Permalink to &quot;FBM&quot;">​</a></h2><p><code>FBM</code>的全称是<code>Fractal Brownian Motion</code>，翻译为<strong>分形布朗运动</strong>，它是将多个具有不同频率和振幅的噪声的结果值相叠加而产生结果的一种随机过程。一般用于构造自然界的云层，山脉，地貌等不规则的形体。</p><p>上文中用的是柏林噪声，这里把噪声换成更加自然的<code>Simplex</code>噪声，它的具体代码如下：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"><span style="color:#6A737D;">// Description : Array and textureless GLSL 2D/3D/4D simplex</span></span>
<span class="line"><span style="color:#6A737D;">//               noise functions.</span></span>
<span class="line"><span style="color:#6A737D;">//      Author : Ian McEwan, Ashima Arts.</span></span>
<span class="line"><span style="color:#6A737D;">//  Maintainer : ijm</span></span>
<span class="line"><span style="color:#6A737D;">//     Lastmod : 20110822 (ijm)</span></span>
<span class="line"><span style="color:#6A737D;">//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.</span></span>
<span class="line"><span style="color:#6A737D;">//               Distributed under the MIT License. See LICENSE file.</span></span>
<span class="line"><span style="color:#6A737D;">//               https://github.com/ashima/webgl-noise</span></span>
<span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec3</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mod289</span><span style="color:#E1E4E8;">(vec3 </span><span style="color:#FFAB70;">x</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(x </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">289.0</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">289.0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mod289</span><span style="color:#E1E4E8;">(vec4 </span><span style="color:#FFAB70;">x</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(x </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">289.0</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">289.0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">permute</span><span style="color:#E1E4E8;">(vec4 </span><span style="color:#FFAB70;">x</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mod289</span><span style="color:#E1E4E8;">(((x</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">34.0</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">+</span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">x);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">vec4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">taylorInvSqrt</span><span style="color:#E1E4E8;">(vec4 </span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.79284291400159</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.85373472095314</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> r;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">snoise</span><span style="color:#E1E4E8;">(vec3 </span><span style="color:#FFAB70;">v</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> vec2  C </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec2</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1.0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">6.0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1.0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">3.0</span><span style="color:#E1E4E8;">) ;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> vec4  D </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0.5</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2.0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// First corner</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 i  </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(v </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(v, C.yyy) );</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 x0 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">   v </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(i, C.xxx) ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Other corners</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 g </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">step</span><span style="color:#E1E4E8;">(x0.yzx, x0.xyz);</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 l </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> g;</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 i1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">min</span><span style="color:#E1E4E8;">( g.xyz, l.zxy );</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 i2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">( g.xyz, l.zxy );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//   x0 = x0 - 0.0 + 0.0 * C.xxx;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//   x1 = x0 - i1  + 1.0 * C.xxx;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//   x2 = x0 - i2  + 2.0 * C.xxx;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//   x3 = x0 - 1.0 + 3.0 * C.xxx;</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 x1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x0 </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> i1 </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> C.xxx;</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 x2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x0 </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> i2 </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> C.yyy;</span><span style="color:#6A737D;"> // 2.0*C.x = 1/3 = C.y</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 x3 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x0 </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> D.yyy;</span><span style="color:#6A737D;">      // -1.0+3.0*C.x = -0.5 = -D.y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Permutations</span></span>
<span class="line"><span style="color:#E1E4E8;">  i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mod289</span><span style="color:#E1E4E8;">(i);</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 p </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">permute</span><span style="color:#E1E4E8;">( </span><span style="color:#B392F0;">permute</span><span style="color:#E1E4E8;">( </span><span style="color:#B392F0;">permute</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">             i.z </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">, i1.z, i2.z, </span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;"> ))</span></span>
<span class="line"><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> i.y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">, i1.y, i2.y, </span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;"> ))</span></span>
<span class="line"><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> i.x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">, i1.x, i2.x, </span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;"> ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Gradients: 7x7 points over a square, mapped onto an octahedron.</span></span>
<span class="line"><span style="color:#6A737D;">// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> n_ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.142857142857</span><span style="color:#E1E4E8;">;</span><span style="color:#6A737D;"> // 1.0/7.0</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3  ns </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> n_ </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> D.wyz </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> D.xzx;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 j </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> p </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">49.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(p </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> ns.z </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> ns.z);</span><span style="color:#6A737D;">  //  mod(p,7*7)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 x_ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(j </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> ns.z);</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 y_ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(j </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> x_ );</span><span style="color:#6A737D;">    // mod(j,N)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x_ </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">ns.x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> ns.yyyy;</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> y_ </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">ns.x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> ns.yyyy;</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 h </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">abs</span><span style="color:#E1E4E8;">(x) </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">abs</span><span style="color:#E1E4E8;">(y);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 b0 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">( x.xy, y.xy );</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 b1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">( x.zw, y.zw );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 s0 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(b0)</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">2.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 s1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(b1)</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">2.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 sh </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#B392F0;">step</span><span style="color:#E1E4E8;">(h, </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 a0 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> b0.xzyw </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> s0.xzyw</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">sh.xxyy ;</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 a1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> b1.xzyw </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> s1.xzyw</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">sh.zzww ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 p0 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(a0.xy,h.x);</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 p1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(a0.zw,h.y);</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 p2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(a1.xy,h.z);</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec3 p3 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(a1.zw,h.w);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//Normalise gradients</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 norm </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">taylorInvSqrt</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(p0,p0), </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(p1,p1), </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(p2, p2), </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(p3,p3)));</span></span>
<span class="line"><span style="color:#E1E4E8;">  p0 </span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;"> norm.x;</span></span>
<span class="line"><span style="color:#E1E4E8;">  p1 </span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;"> norm.y;</span></span>
<span class="line"><span style="color:#E1E4E8;">  p2 </span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;"> norm.z;</span></span>
<span class="line"><span style="color:#E1E4E8;">  p3 </span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;"> norm.w;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mix final noise value</span></span>
<span class="line"><span style="color:#E1E4E8;">  vec4 m </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0.6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(x0,x0), </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(x1,x1), </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(x2,x2), </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(x3,x3)), </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  m </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> m </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> m;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">42.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">( m</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">m, </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">( </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(p0,x0), </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(p1,x1),</span></span>
<span class="line"><span style="color:#E1E4E8;">                                </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(p2,x2), </span><span style="color:#B392F0;">dot</span><span style="color:#E1E4E8;">(p3,x3) ) );</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">#pragma</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">glslify</span><span style="color:#E1E4E8;">: </span><span style="color:#B392F0;">export</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">snoise</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"><span style="color:#6A737D;">// Description : Array and textureless GLSL 2D/3D/4D simplex</span></span>
<span class="line"><span style="color:#6A737D;">//               noise functions.</span></span>
<span class="line"><span style="color:#6A737D;">//      Author : Ian McEwan, Ashima Arts.</span></span>
<span class="line"><span style="color:#6A737D;">//  Maintainer : ijm</span></span>
<span class="line"><span style="color:#6A737D;">//     Lastmod : 20110822 (ijm)</span></span>
<span class="line"><span style="color:#6A737D;">//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.</span></span>
<span class="line"><span style="color:#6A737D;">//               Distributed under the MIT License. See LICENSE file.</span></span>
<span class="line"><span style="color:#6A737D;">//               https://github.com/ashima/webgl-noise</span></span>
<span class="line"><span style="color:#6A737D;">//</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec3</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mod289</span><span style="color:#24292E;">(vec3 </span><span style="color:#E36209;">x</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> x </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(x </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">289.0</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">289.0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mod289</span><span style="color:#24292E;">(vec4 </span><span style="color:#E36209;">x</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> x </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(x </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">289.0</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">289.0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">permute</span><span style="color:#24292E;">(vec4 </span><span style="color:#E36209;">x</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mod289</span><span style="color:#24292E;">(((x</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">34.0</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">+</span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">x);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">vec4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">taylorInvSqrt</span><span style="color:#24292E;">(vec4 </span><span style="color:#E36209;">r</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.79284291400159</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.85373472095314</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> r;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">float</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">snoise</span><span style="color:#24292E;">(vec3 </span><span style="color:#E36209;">v</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> vec2  C </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec2</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1.0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">6.0</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1.0</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">3.0</span><span style="color:#24292E;">) ;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> vec4  D </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0.5</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">2.0</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// First corner</span></span>
<span class="line"><span style="color:#24292E;">  vec3 i  </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(v </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(v, C.yyy) );</span></span>
<span class="line"><span style="color:#24292E;">  vec3 x0 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;">   v </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(i, C.xxx) ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Other corners</span></span>
<span class="line"><span style="color:#24292E;">  vec3 g </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">step</span><span style="color:#24292E;">(x0.yzx, x0.xyz);</span></span>
<span class="line"><span style="color:#24292E;">  vec3 l </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> g;</span></span>
<span class="line"><span style="color:#24292E;">  vec3 i1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">min</span><span style="color:#24292E;">( g.xyz, l.zxy );</span></span>
<span class="line"><span style="color:#24292E;">  vec3 i2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">max</span><span style="color:#24292E;">( g.xyz, l.zxy );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//   x0 = x0 - 0.0 + 0.0 * C.xxx;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//   x1 = x0 - i1  + 1.0 * C.xxx;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//   x2 = x0 - i2  + 2.0 * C.xxx;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//   x3 = x0 - 1.0 + 3.0 * C.xxx;</span></span>
<span class="line"><span style="color:#24292E;">  vec3 x1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> x0 </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> i1 </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> C.xxx;</span></span>
<span class="line"><span style="color:#24292E;">  vec3 x2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> x0 </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> i2 </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> C.yyy;</span><span style="color:#6A737D;"> // 2.0*C.x = 1/3 = C.y</span></span>
<span class="line"><span style="color:#24292E;">  vec3 x3 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> x0 </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> D.yyy;</span><span style="color:#6A737D;">      // -1.0+3.0*C.x = -0.5 = -D.y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Permutations</span></span>
<span class="line"><span style="color:#24292E;">  i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mod289</span><span style="color:#24292E;">(i);</span></span>
<span class="line"><span style="color:#24292E;">  vec4 p </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">permute</span><span style="color:#24292E;">( </span><span style="color:#6F42C1;">permute</span><span style="color:#24292E;">( </span><span style="color:#6F42C1;">permute</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">             i.z </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">, i1.z, i2.z, </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;"> ))</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> i.y </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">, i1.y, i2.y, </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;"> ))</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> i.x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">, i1.x, i2.x, </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;"> ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Gradients: 7x7 points over a square, mapped onto an octahedron.</span></span>
<span class="line"><span style="color:#6A737D;">// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> n_ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.142857142857</span><span style="color:#24292E;">;</span><span style="color:#6A737D;"> // 1.0/7.0</span></span>
<span class="line"><span style="color:#24292E;">  vec3  ns </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> n_ </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> D.wyz </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> D.xzx;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  vec4 j </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> p </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">49.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(p </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> ns.z </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> ns.z);</span><span style="color:#6A737D;">  //  mod(p,7*7)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  vec4 x_ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(j </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> ns.z);</span></span>
<span class="line"><span style="color:#24292E;">  vec4 y_ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(j </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> x_ );</span><span style="color:#6A737D;">    // mod(j,N)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  vec4 x </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> x_ </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">ns.x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> ns.yyyy;</span></span>
<span class="line"><span style="color:#24292E;">  vec4 y </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> y_ </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">ns.x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> ns.yyyy;</span></span>
<span class="line"><span style="color:#24292E;">  vec4 h </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">abs</span><span style="color:#24292E;">(x) </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">abs</span><span style="color:#24292E;">(y);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  vec4 b0 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">( x.xy, y.xy );</span></span>
<span class="line"><span style="color:#24292E;">  vec4 b1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">( x.zw, y.zw );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;</span></span>
<span class="line"><span style="color:#24292E;">  vec4 s0 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(b0)</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">2.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  vec4 s1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">floor</span><span style="color:#24292E;">(b1)</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">2.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  vec4 sh </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">step</span><span style="color:#24292E;">(h, </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  vec4 a0 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> b0.xzyw </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> s0.xzyw</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">sh.xxyy ;</span></span>
<span class="line"><span style="color:#24292E;">  vec4 a1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> b1.xzyw </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> s1.xzyw</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">sh.zzww ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  vec3 p0 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(a0.xy,h.x);</span></span>
<span class="line"><span style="color:#24292E;">  vec3 p1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(a0.zw,h.y);</span></span>
<span class="line"><span style="color:#24292E;">  vec3 p2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(a1.xy,h.z);</span></span>
<span class="line"><span style="color:#24292E;">  vec3 p3 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(a1.zw,h.w);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//Normalise gradients</span></span>
<span class="line"><span style="color:#24292E;">  vec4 norm </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">taylorInvSqrt</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(p0,p0), </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(p1,p1), </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(p2, p2), </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(p3,p3)));</span></span>
<span class="line"><span style="color:#24292E;">  p0 </span><span style="color:#D73A49;">*=</span><span style="color:#24292E;"> norm.x;</span></span>
<span class="line"><span style="color:#24292E;">  p1 </span><span style="color:#D73A49;">*=</span><span style="color:#24292E;"> norm.y;</span></span>
<span class="line"><span style="color:#24292E;">  p2 </span><span style="color:#D73A49;">*=</span><span style="color:#24292E;"> norm.z;</span></span>
<span class="line"><span style="color:#24292E;">  p3 </span><span style="color:#D73A49;">*=</span><span style="color:#24292E;"> norm.w;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Mix final noise value</span></span>
<span class="line"><span style="color:#24292E;">  vec4 m </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">max</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0.6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(x0,x0), </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(x1,x1), </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(x2,x2), </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(x3,x3)), </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  m </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> m </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> m;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">42.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">( m</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">m, </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">( </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(p0,x0), </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(p1,x1),</span></span>
<span class="line"><span style="color:#24292E;">                                </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(p2,x2), </span><span style="color:#6F42C1;">dot</span><span style="color:#24292E;">(p3,x3) ) );</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">#pragma</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">glslify</span><span style="color:#24292E;">: </span><span style="color:#6F42C1;">export</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">snoise</span><span style="color:#24292E;">)</span></span></code></pre></div><p>然后来实现<code>fbm</code>函数：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">fbm</span><span style="color:#E1E4E8;">(vec3 </span><span style="color:#FFAB70;">p</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> value</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> amplitude</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> frequency</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> lacunarity</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">2.</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> persistance</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">.5</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> scale</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> octaves</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> i</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;i</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">octaves;i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> noiseVal</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">snoise</span><span style="color:#E1E4E8;">(p</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">frequency</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">scale);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span></span>
<span class="line"><span style="color:#E1E4E8;">                    value</span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;">amplitude</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">noiseVal;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    frequency</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">lacunarity;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    amplitude</span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;">persistance;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> value;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">fbm</span><span style="color:#24292E;">(vec3 </span><span style="color:#E36209;">p</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> value</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> amplitude</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> frequency</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> lacunarity</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">2.</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> persistance</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">.5</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> scale</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> octaves</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">8</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                </span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">for</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;i</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">octaves;i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> noiseVal</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">snoise</span><span style="color:#24292E;">(p</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">frequency</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">scale);</span></span>
<span class="line"><span style="color:#24292E;">                    </span></span>
<span class="line"><span style="color:#24292E;">                    value</span><span style="color:#D73A49;">+=</span><span style="color:#24292E;">amplitude</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">noiseVal;</span></span>
<span class="line"><span style="color:#24292E;">                    frequency</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">lacunarity;</span></span>
<span class="line"><span style="color:#24292E;">                    amplitude</span><span style="color:#D73A49;">*=</span><span style="color:#24292E;">persistance;</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">                </span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> value;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span></code></pre></div><p>这里定义了几个变量：<code>value</code>代表结果值，<code>amplitude</code>代表振幅，<code>frequency</code>代表频率，<code>lacunarity</code>代表空隙，<code>persistance</code>代表持续度，<code>scale</code>代表缩放程度，<code>octaves</code>代表音度。</p><p>然后通过<code>for</code>循环来叠加噪声，叠加的次数就是音度，在叠加的同时升高频率，降低振幅。</p><p>通过uv来进行观察：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mainImage</span><span style="color:#E1E4E8;">(out vec4 </span><span style="color:#FFAB70;">fragColor</span><span style="color:#E1E4E8;">,in vec2 </span><span style="color:#FFAB70;">fragCoord</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">                vec2 uv</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fragCoord</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">iResolution.xy;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">float</span><span style="color:#E1E4E8;"> noise </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">fbm</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(uv,</span><span style="color:#79B8FF;">0.</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">                vec3 col </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec3</span><span style="color:#E1E4E8;">(noise);</span></span>
<span class="line"><span style="color:#E1E4E8;">                fragColor </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">vec4</span><span style="color:#E1E4E8;">(col,</span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">//fragColor=col;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mainImage</span><span style="color:#24292E;">(out vec4 </span><span style="color:#E36209;">fragColor</span><span style="color:#24292E;">,in vec2 </span><span style="color:#E36209;">fragCoord</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">                vec2 uv</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fragCoord</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">iResolution.xy;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">float</span><span style="color:#24292E;"> noise </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">fbm</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(uv,</span><span style="color:#005CC5;">0.</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">                vec3 col </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec3</span><span style="color:#24292E;">(noise);</span></span>
<span class="line"><span style="color:#24292E;">                fragColor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">vec4</span><span style="color:#24292E;">(col,</span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">//fragColor=col;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span></code></pre></div><p>会得到一个云层一般的噪声图案 <img src="`+t+'" alt="云层噪声"></p>',43),E=[y];function i(F,C,A,v,D,g){return n(),a("div",null,E)}const B=s(r,[["render",i]]);export{x as __pageData,B as default};
