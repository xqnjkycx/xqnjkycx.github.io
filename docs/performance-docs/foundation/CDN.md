# CDN
:::tip 基本概念
CDN (Content Delivery NetWork，即内容分发网络) 指的是一组分布在各个地区的服务器。这些服务器存储着数据的副本，因此服务器可以根据哪些服务器与用户距离最近，来满足数据的请求。

CDN提供快速服务，较少受到高流量影响。
:::

## 为什么使用CDN
像前文类似的缓存，本地存储带来的提升，都是需要在**获取到资源并把它们存起来**这件事情发生之后的优化。也就是说在首次请求资源时，CDN可以提升首次请求的响应能力。

其实现思路：通过在网络各处放置**节点服务器**所构成的在现有的互联网基础之上的一层**智能虚拟网络**，CDN系统能够实时地根据网络流量和各节点的**连接和负载状况**以及到用户的距离和响应时间等综合信息将用户的请求重新**导向离用户最近的服务节点**上，加快访问速度

## CDN的基本工作流程
如果**不使用CDN**，其情况为：
- 用户在自己的浏览器中输入要访问的网站域名
- 浏览器向 本地DNS服务器 请求对该域名的解析
- 本地DNS服务器中如果缓存有这个域名的解析结果，则直接响应用户的解析请求
- 本地DNS服务器中如果没有关于这个域名的解析结果的缓存，则以递归方式向整个DNS系统请求解析，获得应答后将结果反馈给浏览器
- 浏览器得到域名解析结果，就是该域名相应的服务设备的 IP地址
- 浏览器向服务器请求内容
- 服务器将用户请求内容传送给浏览器

如果**使用了CDN**时，DNS服务器根据用户IP地址，将域名解析成相应节点的缓存服务器IP地址，从而实现用户的就近访问。当时用CDN服务的设备，只需要将其域名解析权交给CDN的全局负载均衡设备，将需要分发的内容注入CDN即可。
- 当用户点击网站页面上的内容URL，经过**本地**DNS系统解析，DNS 系统会最终将域名的解析权交给 `CNAME` 指向的 CDN 专用 DNS 服务器
- CDN 的 DNS 服务器将 CDN 的**全局负载均衡设备** `IP` 地址返回用户。
- 用户向 CDN 的全局负载均衡设备发起内容 URL 访问请求
- CDN 全局负载均衡设备根据用户 IP 地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求
- 基于以下这些条件的综合分析之后，区域负载均衡设备会向全局负载均衡设备返回一台缓存服务器的IP地址：
    - 1.根据用户 IP 地址，判断哪一台服务器距用户最近
    - 2.根据用户所请求的 URL 中携带的内容名称，判断哪一台服务器上有用户所需内容
    - 3.查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力
- 全局负载均衡设备把服务器的 IP 地址返回给用户
- 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。

## CDN核心功能
当一位用户向服务器A请求资源时，也许在网络带宽小，用户访问量大的情况下，A服务器并不能给用户非常快的响应速度。那么可以将资源copy一份放到服务器B里，当用户请求资源时，就近拿去服务器B的资源。

如果服务器B并没有copy这份资源，那么就回再向服务器A请求资源。

那么服务器B就充当了CDN的角色，CDN的核心有两个点，分别是**缓存**和**回源**。**缓存**意味着把资源Copy到CDN服务器上，**回源**就代表CDN服务器发现匹配不到资源(一般来说，缓存的数据过期了)，然后向跟服务器去获取资源这个过程。

## CDN的实际应用
**CDN**一般用于存放静态资源。上文的“根服务器”本质上是业务服务器，它的核心任务在于**生成动态页面或返回非纯静态页面（JSP,服务端渲染出的HTML页面）**。像“静态资源”，就是JS，CSS，图片等不需要业务服务器进行计算获得就可以得到的资源。

静态资源本身具有访问频率高，承接流量大的特点，因此静态资源加载速度始终是前端性能的一个非常关键的指标。CDN是静态资源提速的重要手段，更是一种规定。

比如在掘金上，可以看到一些静态资源，比如“图片”就是CDN请求来的

![image](./assets/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8BCDN.png)